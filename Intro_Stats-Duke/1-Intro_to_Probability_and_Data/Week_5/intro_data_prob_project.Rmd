---
title: "Exploring the BRFSS data"
output: 
  html_document: 
    fig_height: 4
    highlight: pygments
    theme: spacelab
---

## Setup

### Load packages

```{r load-packages, message = FALSE}
library(ggplot2)
library(dplyr)
library(maps)
```

### Load data

```{r load-data}
load("brfss2013.RData")
```



* * *

## Part 1: Data

The observations in th BRFSS 2013 are collected via phone calls (both cell and 
landline). Landline interviewees are randomly selected adults within a household, 
cell interviewees reside in either private residences or college housing.

This makes the information only generalizable to individuals who have:
1. A phone of either type
2. Stable living situation

While this may represent a majority of the population, it excludes many groups 
who may engage in behavior qualifying as making them "at risk." Especially for the 
topic of `immunization` this makes the data non-generalizable (due to how herd 
immunity's effectiveness is susceptible to deviations from "normalcy" by small groups)

* * *

## Part 2: Research questions

**Research quesion 1:**
What is the relation between mental health and state residency?
**Research quesion 2:**
Do Students who live on campus have different sleeping habits?
**Research quesion 3:**
Do the financially insecure live in a harsher world? (subject to data availability)
snctmony and misphlpf

* * *

## Part 3: Exploratory data analysis

NOTE: Insert code chunks as needed by clicking on the "Insert a new code chunk" 
button (green button with orange arrow) above. Make sure that your code is visible
in the project you submit. Delete this note when before you submit your work.

**Research quesion 1:**

```{r}
sadstate <- brfss2013 %>%
  select(X_state, menthlth) %>%
  filter(menthlth <= 31) %>% # Can't have more bad days than there are in a month
  na.omit()
colnames(sadstate) <- c("state", "mntl")

p <- ggplot(data = sadstate, aes(x = mntl)) +
  geom_bar() +
  labs(title = "Poor Mental Health Days per Respondent",
       x = "Number of bad mental health days in the past month",
       y = "Number of respondents")
p
```
 The data are heavily right skewed, so mean is unreliable.
```{r}
natl_avg_bad_days <- mean(sadstate$mntl)
natl_med_bad_days <- median(sadstate$mntl)

bad_days_by_state <- sadstate %>%
  group_by(state) %>%
  summarise(state_avg = mean(mntl)) %>%
  mutate(dev = state_avg - natl_avg_bad_days)

p <- ggplot(data = bad_days_by_state %>%
              arrange(desc(state_avg)), aes(x = reorder(state, state_avg), y = state_avg)) +
  geom_point() +
  theme(axis.text.x = element_text(angle=90)) +
  labs(title = "Average Poor Mental Health Days per State",
       x = "State",
       y = "Average Days per Month of Poor Mental Health") +
  coord_flip()

# TODO: Make a divergent color map centered at 0, use dev and map states with deviation
range_dev <- range(bad_days_by_state$dev)

# geom_polygon(data = bad_days_by_state, aes(fill = dev)) +
# scale_fill_gradient(colors = c(blue, white, orange),
#                    breaks = c(-1, 0, 1))

usa <- map_data("usa")
```



**Research quesion 2:**

```{r}
brfss2013$sleptim1
```



**Research quesion 3:**

```{r}

```

